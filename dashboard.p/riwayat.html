<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riwayat Pasien</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Variabel CSS (dari dashboard_pasien.html untuk konsistensi) */
        :root {
            --primary-color: #1de9b6; /* Hijau terang, untuk sidebar, tabel header, dll. */
            --primary-dark: #00b686; /* Hijau gelap, untuk hover, background tombol utama */
            --secondary-color: #333; /* Warna hitam untuk logout border/background dan teks */
            --light-color: #f4f4f4; /* Background umum */
            --danger-color: #f44336; /* Warna merah untuk danger */
            --success-color: #4CAF50;
            --text-color: #333;
            --white: #fff;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --sidebar-width: 250px;
            --sidebar-minimized-width: 60px;
        }

        /* Reset dan Box Sizing Global */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            display: flex; /* Penting untuk layout sidebar dan konten */
            min-height: 100vh;
            background-color: var(--light-color);
            overflow-x: hidden; /* Mencegah scrollbar horizontal yang tidak diinginkan */
        }

        /* NEW/MODIFIED CSS FOR SIDEBAR AND MAIN CONTENT TOGGLE */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--primary-color);
            color: var(--white);
            padding: 20px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            flex-shrink: 0;
            box-shadow: var(--shadow);
            position: fixed; /* Menjaga sidebar tetap di tempatnya */
            height: 100vh; /* Memastikan sidebar mengambil tinggi penuh */
            z-index: 1000;
        }

        .sidebar.minimized {
            width: var(--sidebar-minimized-width);
        }

        .sidebar .logo {
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
            font-weight: bold;
            color: var(--white);
            transition: opacity 0.3s ease;
        }

        .sidebar.minimized .logo {
            opacity: 0;
            height: 0;
            overflow: hidden;
        }

        .sidebar nav ul {
            list-style: none;
        }

        .sidebar nav ul li {
            margin-bottom: 10px;
        }

        .sidebar nav ul li a {
            color: var(--white);
            text-decoration: none;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            border-radius: 5px;
            transition: background-color 0.3s ease, padding 0.3s ease;
        }

        .sidebar nav ul li a:hover,
        .sidebar nav ul li a.active {
            background-color: var(--primary-dark);
        }

        .sidebar nav ul li a i {
            margin-right: 10px;
            font-size: 18px;
            width: 20px;
            text-align: center;
        }

        .sidebar nav ul li a span {
            transition: opacity 0.3s ease, max-width 0.3s ease;
            white-space: nowrap;
            overflow: hidden;
            max-width: 100%;
        }

        .sidebar.minimized nav ul li a span {
            opacity: 0;
            max-width: 0;
        }

        .sidebar .logout-btn {
            background-color: var(--secondary-color);
            color: var(--white);
            padding: 10px 15px;
            border-radius: 5px;
            text-align: center;
            margin-top: auto;
            text-decoration: none;
            transition: background-color 0.3s ease, opacity 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar .logout-btn i {
            margin-right: 10px;
        }

        .sidebar.minimized .logout-btn {
            opacity: 0;
            pointer-events: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            justify-content: center;
            align-items: center;
            margin-left: auto;
            margin-right: auto;
            overflow: hidden;
        }

        .sidebar.minimized .logout-btn i {
            margin-right: 0;
        }

        .sidebar.minimized .logout-btn span {
            display: none;
        }

        .main-content {
            flex-grow: 1;
            margin-left: var(--sidebar-width);
            transition: margin-left 0.3s ease;
            display: flex;
            flex-direction: column;
            width: calc(100% - var(--sidebar-width));
        }

        .main-content.sidebar-minimized {
            margin-left: var(--sidebar-minimized-width);
            width: calc(100% - var(--sidebar-minimized-width));
        }

        .header {
            background-color: var(--white);
            padding: 15px 20px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 999;
        }

        .header .left-section {
            display: flex;
            align-items: center;
        }

        /* MENU TOGGLE BUTTON STYLES */
        .header .menu-toggle {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
            margin-right: 20px;
            padding: 5px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .header .menu-toggle:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .header h1 {
            font-size: 24px;
            color: var(--text-color);
            margin: 0;
        }

        .header .user-profile {
            display: flex;
            align-items: center;
        }

        .header .user-profile .username {
            margin-right: 10px;
            font-weight: bold;
            color: var(--text-color);
        }

        .header .user-profile .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            color: var(--text-color);
            cursor: pointer;
        }

        /* Main Content Styling */
        main {
            padding: 20px;
            flex-grow: 1;
            background-color: var(--light-color);
        }

        .filter-container {
            background-color: var(--white);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .filter-container label {
            font-weight: bold;
            color: var(--text-color);
        }

        .filter-container input[type="date"],
        .filter-container input[type="text"],
        .filter-container select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            min-width: 150px;
            flex: 1;
        }

        .filter-container button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .filter-container button.primary {
            background-color: var(--primary-color);
            color: var(--white);
        }

        .filter-container button.primary:hover {
            background-color: var(--primary-dark);
        }

        .filter-container button.secondary {
            background-color: var(--secondary-color);
            color: var(--white);
        }

        .filter-container button.secondary:hover {
            background-color: #555;
        }

        .table-container {
            background-color: var(--white);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        table thead th {
            background-color: var(--primary-color);
            color: var(--white);
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        table tbody td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            color: var(--text-color);
        }

        table tbody tr:hover {
            background-color: #f9f9f9;
        }

        .action-buttons button {
            padding: 8px 12px;
            margin-right: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

        .action-buttons .edit-btn {
            background-color: #2196F3; /* Blue */
            color: white;
        }

        .action-buttons .edit-btn:hover {
            background-color: #0b7dda;
        }

        .action-buttons .delete-btn {
            background-color: var(--danger-color);
            color: white;
        }

        .action-buttons .delete-btn:hover {
            background-color: #da190b;
        }

        /* Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 2000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--white);
            margin: auto;
            padding: 30px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            max-width: 600px;
            width: 100%;
            position: relative;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .modal-content h2 {
            margin-top: 0;
            color: var(--text-color);
            margin-bottom: 20px;
        }

        .modal-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--text-color);
        }

        .modal-form input[type="text"],
        .modal-form input[type="password"],
        .modal-form input[type="date"],
        .modal-form input[type="email"],
        .modal-form input[type="number"],
        .modal-form select,
        .modal-form textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .modal-form .form-group {
            margin-bottom: 15px;
        }

        .modal-form .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-form button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .modal-form button.save-btn {
            background-color: var(--primary-color);
            color: var(--white);
        }

        .modal-form button.save-btn:hover {
            background-color: var(--primary-dark);
        }

        .modal-form button.cancel-btn {
            background-color: #ccc;
            color: var(--text-color);
        }

        .modal-form button.cancel-btn:hover {
            background-color: #bbb;
        }

        .modal-form .input-group {
            position: relative;
        }

        .modal-form .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #888;
        }

        .print-pdf-btn {
            background-color: var(--danger-color); /* Red for PDF */
            color: var(--white);
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
            display: block; /* Make it a block element to take full width */
            width: fit-content; /* Adjust width to content */
        }
        .print-pdf-btn:hover {
            background-color: #da190b;
        }

        /* Print Specific Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            .table-container, .table-container * {
                visibility: visible;
            }
            .table-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
                padding: 0;
            }
            .filter-container, .header, .sidebar, .modal, .pagination, .print-pdf-btn, .action-buttons {
                display: none !important;
            }
            table {
                width: 100%;
                border-collapse: collapse;
            }
            table thead th, table tbody td {
                border: 1px solid #ccc !important;
                padding: 8px !important;
                background-color: #fff !important;
                color: #000 !important;
            }
            table thead th {
                background-color: #e0e0e0 !important;
            }
        }

    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">Klinik</div>
        <nav>
            <ul>
                <li><a href="#"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
                <li><a href="transaksi.html"><i class="fas fa-exchange-alt"></i> <span>Transaksi</span></a></li>
                <li><a href="#" class="active"><i class="fas fa-history"></i> <span>Riwayat</span></a></li>
            </ul>
        </nav>
        <a href="#" class="logout-btn"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a>
    </div>

    <div class="main-content">
        <div class="header">
            <div class="left-section">
                <button class="menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>Riwayat Pasien</h1>
            </div>
            <div class="user-profile">
                <span class="username">Dr. Budi</span>
                <div class="profile-pic"><i class="fas fa-user-md"></i></div>
            </div>
        </div>

        <main>
            <div class="filter-container">
                <label for="filterDate">Filter Tanggal:</label>
                <input type="date" id="filterDate">

                <label for="filterPatientName">Nama Pasien:</label>
                <input type="text" id="filterPatientName" placeholder="Cari nama pasien">

                <label for="filterService">Layanan:</label>
                <select id="filterService">
                    <option value="">Semua Layanan</option>
                    <option value="Pemeriksaan Umum">Pemeriksaan Umum</option>
                    <option value="Cabut Gigi">Cabut Gigi</option>
                    <option value="Scaling Gigi">Scaling Gigi</option>
                    <option value="Konsultasi Gizi">Konsultasi Gizi</option>
                    <option value="Vaksinasi Flu">Vaksinasi Flu</option>
                </select>

                <button class="primary" id="applyFilterBtn">Terapkan Filter</button>
                <button class="secondary" id="clearFilterBtn">Bersihkan Filter</button>
            </div>

            <button class="print-pdf-btn" id="printPdfBtn"><i class="fas fa-print"></i> Cetak PDF</button>

            <div class="table-container">
                <table id="patientHistoryTable">
                    <thead>
                        <tr>
                            <th>ID Riwayat</th>
                            <th>Tanggal</th>
                            <th>Nama Pasien</th>
                            <th>Layanan</th>
                            <th>Diagnosa</th>
                            <th>Obat</th>
                            <th>Catatan</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody">
                        </tbody>
                </table>
            </div>
        </main>
    </div>

    <div id="patientHistoryModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Detail Riwayat Pasien</h2>
            <form id="patientHistoryForm" class="modal-form">
                <input type="hidden" id="historyId">
                <div class="form-group">
                    <label for="patientName">Nama Pasien:</label>
                    <input type="text" id="patientName" required>
                </div>
                <div class="form-group">
                    <label for="service">Layanan:</label>
                    <input type="text" id="service" required>
                </div>
                <div class="form-group">
                    <label for="diagnosis">Diagnosa:</label>
                    <textarea id="diagnosis" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="medication">Obat:</label>
                    <textarea id="medication" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="notes">Catatan:</label>
                    <textarea id="notes" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="save-btn">Simpan</button>
                    <button type="button" class="cancel-btn">Batal</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // MENU TOGGLE JAVASCRIPT (NEW)
        document.addEventListener('DOMContentLoaded', function() {
            const menuToggle = document.querySelector('.menu-toggle');
            const sidebar = document.querySelector('.sidebar');
            const mainContent = document.querySelector('.main-content');

            if (menuToggle && sidebar && mainContent) {
                menuToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('minimized');
                    mainContent.classList.toggle('sidebar-minimized');
                });
            } else {
                console.error("DEBUG: One or more required elements for menu toggle not found:");
                if (!menuToggle) console.error("  - Element with class 'menu-toggle' is missing.");
                if (!sidebar) console.error("  - Element with class 'sidebar' is missing.");
                if (!mainContent) console.error("  - Element with class 'main-content' is missing.");
            }
        });

        // Existing JavaScript for Riwayat Page
        let patientHistoryData = [
            { id: 'R001', date: '2023-01-15', patientName: 'Budi Santoso', service: 'Pemeriksaan Umum', diagnosis: 'Flu ringan', medication: 'Paracetamol', notes: 'Istirahat cukup.' },
            { id: 'R002', date: '2023-01-15', patientName: 'Citra Dewi', service: 'Cabut Gigi', diagnosis: 'Karies gigi', medication: 'Amoxicillin', notes: 'Hindari makanan keras.' },
            { id: 'R003', date: '2023-01-16', patientName: 'Dewi Lestari', service: 'Scaling Gigi', diagnosis: 'Tartar', medication: '-', notes: 'Jaga kebersihan gigi.' },
            { id: 'R004', date: '2023-01-16', patientName: 'Eka Putra', service: 'Konsultasi Gizi', diagnosis: 'Kurang gizi', medication: 'Multivitamin', notes: 'Perbanyak sayur dan buah.' },
            { id: 'R005', date: '2023-01-17', patientName: 'Fajar Indah', service: 'Vaksinasi Flu', diagnosis: '-', medication: 'Vaksin Flu', notes: 'Efek samping ringan wajar.' },
            { id: 'R006', date: '2023-01-17', patientName: 'Gilang Ramadhan', service: 'Pemeriksaan Umum', diagnosis: 'Demam', medication: 'Obat demam', notes: 'Kompres hangat.' },
            { id: 'R007', date: '2023-01-18', patientName: 'Hana Permata', service: 'Fisioterapi', diagnosis: 'Keseleo', medication: 'Topical analgesic', notes: 'Latihan ringan.' },
            { id: 'R008', date: '2023-01-18', patientName: 'Indra Wijaya', service: 'Pemeriksaan Darah', diagnosis: 'Anemia', medication: 'Suplemen zat besi', notes: 'Makan makanan kaya zat besi.' },
            { id: 'R009', date: '2023-01-19', patientName: 'Joko Susanto', service: 'Pengobatan Jerawat', diagnosis: 'Acne vulgaris', medication: 'Topical cream', notes: 'Bersihkan wajah teratur.' },
            { id: 'R010', date: '2023-01-19', patientName: 'Kartika Sari', service: 'Tes COVID-19', diagnosis: 'Negatif', medication: '-', notes: 'Tetap jaga protokol kesehatan.' }
        ];

        const historyTableBody = document.getElementById('historyTableBody');
        const patientHistoryModal = document.getElementById('patientHistoryModal');
        const closeButton = patientHistoryModal.querySelector('.close-button');
        const cancelButton = patientHistoryModal.querySelector('.cancel-btn');
        const patientHistoryForm = document.getElementById('patientHistoryForm');
        const historyIdInput = document.getElementById('historyId');
        const patientNameInput = document.getElementById('patientName');
        const serviceInput = document.getElementById('service');
        const diagnosisInput = document.getElementById('diagnosis');
        const medicationInput = document.getElementById('medication');
        const notesInput = document.getElementById('notes');

        const filterDateInput = document.getElementById('filterDate');
        const filterPatientNameInput = document.getElementById('filterPatientName');
        const filterServiceSelect = document.getElementById('filterService');
        const applyFilterBtn = document.getElementById('applyFilterBtn');
        const clearFilterBtn = document.getElementById('clearFilterBtn');
        const printPdfBtn = document.getElementById('printPdfBtn');

        const formatDate = (dateString) => {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('id-ID', options);
        };

        const loadPatientData = () => {
            historyTableBody.innerHTML = '';
            const filteredData = patientHistoryData.filter(data => {
                const matchesDate = !filterDateInput.value || data.date === filterDateInput.value;
                const matchesPatientName = !filterPatientNameInput.value || data.patientName.toLowerCase().includes(filterPatientNameInput.value.toLowerCase());
                const matchesService = !filterServiceSelect.value || data.service === filterServiceSelect.value;
                return matchesDate && matchesPatientName && matchesService;
            });

            filteredData.forEach(data => {
                const row = historyTableBody.insertRow();
                row.innerHTML = `
                    <td>${data.id}</td>
                    <td>${formatDate(data.date)}</td>
                    <td>${data.patientName}</td>
                    <td>${data.service}</td>
                    <td>${data.diagnosis}</td>
                    <td>${data.medication}</td>
                    <td>${data.notes}</td>
                    <td class="action-buttons">
                        <button class="edit-btn" data-id="${data.id}"><i class="fas fa-edit"></i> Edit</button>
                        <button class="delete-btn" data-id="${data.id}"><i class="fas fa-trash"></i> Hapus</button>
                    </td>
                `;
            });

            // Add event listeners for edit and delete buttons after rendering
            document.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', (event) => openEditModal(event.target.dataset.id));
            });

            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', (event) => deletePatientHistory(event.target.dataset.id));
            });
        };

        const openEditModal = (id) => {
            const data = patientHistoryData.find(d => d.id === id);
            if (data) {
                historyIdInput.value = data.id;
                patientNameInput.value = data.patientName;
                serviceInput.value = data.service;
                diagnosisInput.value = data.diagnosis;
                medicationInput.value = data.medication;
                notesInput.value = data.notes;
                patientHistoryModal.classList.add('active');
            }
        };

        const closePatientHistoryModal = () => {
            patientHistoryModal.classList.remove('active');
            patientHistoryForm.reset();
        };

        const savePatientHistory = (event) => {
            event.preventDefault();
            const id = historyIdInput.value;
            const updatedData = {
                id: id,
                date: patientHistoryData.find(d => d.id === id)?.date || new Date().toISOString().slice(0, 10), // Keep original date or set current
                patientName: patientNameInput.value,
                service: serviceInput.value,
                diagnosis: diagnosisInput.value,
                medication: medicationInput.value,
                notes: notesInput.value
            };

            const index = patientHistoryData.findIndex(d => d.id === id);
            if (index !== -1) {
                patientHistoryData[index] = updatedData;
            } else {
                // For a new entry, generate a unique ID
                const newId = 'R' + String(patientHistoryData.length + 1).padStart(3, '0');
                updatedData.id = newId;
                patientHistoryData.push(updatedData);
            }
            loadPatientData();
            closePatientHistoryModal();
        };

        const deletePatientHistory = (id) => {
            if (confirm(`Apakah Anda yakin ingin menghapus riwayat dengan ID ${id}?`)) {
                patientHistoryData = patientHistoryData.filter(data => data.id !== id);
                loadPatientData();
            }
        };

        const filterData = () => {
            loadPatientData(); // Reload data with current filter settings
        };

        // Event Listeners
        closeButton.addEventListener('click', closePatientHistoryModal);
        cancelButton.addEventListener('click', closePatientHistoryModal);
        patientHistoryForm.addEventListener('submit', savePatientHistory);

        // document.querySelectorAll('.modal .toggle-password').forEach(toggle => {
        //     toggle.addEventListener('click', function() {
        //         const targetId = this.dataset.target;
        //         const passwordInput = document.getElementById(targetId);
        //         const icon = this.querySelector('i');

        //         if (passwordInput.type === 'password') {
        //             passwordInput.type = 'text';
        //             icon.classList.remove('fa-eye-slash');
        //             icon.classList.add('fa-eye');
        //         } else {
        //             passwordInput.type = 'password';
        //             icon.classList.remove('fa-eye');
        //             icon.classList.add('fa-eye-slash');
        //         }
        //     });
        // });

        printPdfBtn.addEventListener('click', () => {
            window.print();
        });


        // --- Initial Data Load and Filter ---
        loadPatientData();
        filterData(); // Apply filter initially to show all records for the logged-in user

        // --- Filter Button Events ---
        applyFilterBtn.addEventListener('click', filterData);
        clearFilterBtn.addEventListener('click', () => {
            filterDateInput.value = ''; // Clear the single date filter
            filterPatientNameInput.value = ''; // Clear patient name filter
            filterServiceSelect.value = ''; // Clear service filter
            filterData();
        });
    </script>
</body>
</html>
